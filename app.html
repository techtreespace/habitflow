<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>습관 트래커</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body, #root { height: 100%; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Apple SD Gothic Neo, sans-serif; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="bg-slate-50">
  <div id="root"></div>

  <!-- 반드시 text/babel로 지정 -->
  <script type="text/babel">
    const {useEffect, useRef, useState} = React;
    const root = ReactDOM.createRoot(document.getElementById('root'));

    const todayStr = () => new Date().toDateString();
    const uid = () => Date.now() + Math.random().toString(16).slice(2);
    const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));
    const load = (k, d) => { try { const x = localStorage.getItem(k); return x ? JSON.parse(x) : d; } catch { return d; } };

    const CATEGORIES = ["건강","운동","학습","생활","자기계발"];    
    const ICONS = ["🎯","💧","🚶","🏃","📚","🧘","🛏️","☀️","🧠","💪"];  
    const COLORS = ["bg-blue-500","bg-green-500","bg-purple-500","bg-rose-500","bg-amber-500","bg-indigo-500","bg-teal-500"]; 

    const Modal = ({title, onClose, children}) => (
      <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
        <div className="absolute inset-0 bg-black/50" onClick={onClose} />
        <div className="relative w-full max-w-md bg-white rounded-2xl shadow-xl overflow-hidden">
          <div className="flex items-center justify-between px-6 py-4 border-b">
            <h3 className="text-lg font-bold">{title}</h3>
            <button onClick={onClose} className="w-8 h-8 grid place-items-center rounded-full hover:bg-slate-100">✕</button>
          </div>
          <div className="p-6">{children}</div>
        </div>
      </div>
    );

    const TabButton = ({active, onClick, children}) => (
      <button onClick={onClick} className={\`px-4 py-2 rounded-xl text-sm font-medium \${active? 'bg-slate-900 text-white':'bg-white text-slate-700 border'}\`}>{children}</button>
    );

    function IMEInput({value, onChange, onSubmit, placeholder, autoFocus}) {
      const ref = useRef(null);
      const [isComposing, setIsComposing] = useState(false);
      useEffect(() => { if (autoFocus && ref.current) ref.current.focus(); }, [autoFocus]);
      return (
        <input
          ref={ref}
          value={value}
          onChange={e => onChange(e.target.value)}
          onCompositionStart={() => setIsComposing(true)}
          onCompositionEnd={e => { setIsComposing(false); onChange(e.target.value); }}
          onKeyDown={e => {
            const composing = isComposing || e.keyCode === 229 || (e.nativeEvent && e.nativeEvent.isComposing);
            if (e.key === 'Enter' && !composing) {
              e.preventDefault();
              onSubmit?.();
            }
          }}
          type="text"
          className="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500"
          placeholder={placeholder}
        />
      );
    }

    function App(){
      const [habits, setHabits] = useState(() => load('habits', []));
      const [tab, setTab] = useState('today');
      const [userName, setUserName] = useState(() => load('userName', '사용자'));
      const [showAdd, setShowAdd] = useState(false);
      const [addForm, setAddForm] = useState({ title: '', category: CATEGORIES[0], icon: ICONS[0], color: COLORS[0] });
      const [showEdit, setShowEdit] = useState(false);
      const [editTarget, setEditTarget] = useState(null);

      useEffect(() => save('habits', habits), [habits]);
      useEffect(() => save('userName', userName), [userName]);

      const toggleToday = (id) => {
        const t = todayStr();
        setHabits(prev => prev.map(h => {
          if (h.id !== id) return h;
          const set = new Set(h.completedDates || []);
          if (set.has(t)) set.delete(t); else set.add(t);
          return {...h, completedDates: Array.from(set)};
        }));
      };

      const addHabit = () => {
        const title = addForm.title.trim();
        if (!title) return;
        if (habits.some(h => h.title === title)) { alert('이미 같은 이름의 습관이 있어요.'); return; }
        setHabits(prev => [...prev, {
          id: uid(), title, category: addForm.category, icon: addForm.icon, color: addForm.color,
          createdAt: new Date().toISOString(), completedDates: []
        }]);
        setAddForm({ title: '', category: CATEGORIES[0], icon: ICONS[0], color: COLORS[0] });
        setShowAdd(false);
      };

      const openEdit = (h) => { setEditTarget({...h}); setShowEdit(true); };
      const saveEdit = () => {
        if (!editTarget.title.trim()) return;
        setHabits(prev => prev.map(h => h.id === editTarget.id ? editTarget : h));
        setShowEdit(false);
      };

      const removeHabit = (id) => {
        if (!confirm('정말 삭제할까요?')) return;
        setHabits(prev => prev.filter(h => h.id !== id));
      };

      const completedTodayCount = habits.filter(h => (h.completedDates||[]).includes(todayStr())).length;
      const totalCount = habits.length;
      const progress = totalCount? Math.round((completedTodayCount/totalCount)*100) : 0;

      return (
        <div className="min-h-screen flex flex-col">
          <header className="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-5">
            <div className="max-w-3xl mx-auto flex items-center justify-between">
              <div>
                <h1 className="text-2xl font-bold">습관 트래커</h1>
                <p className="text-sm opacity-80 mt-1">안녕하세요, {userName}님 👋</p>
              </div>
              <button onClick={() => setShowAdd(true)} className="px-4 py-2 bg-white/15 hover:bg-white/25 rounded-xl border border-white/20">새 습관 추가</button>
            </div>
          </header>
          <nav className="sticky top-0 bg-white border-b z-10">
            <div className="max-w-3xl mx-auto flex gap-2 p-3">
              <TabButton active={tab==='today'} onClick={()=>setTab('today')}>오늘</TabButton>
              <TabButton active={tab==='habits'} onClick={()=>setTab('habits')}>습관</TabButton>
              <TabButton active={tab==='stats'} onClick={()=>setTab('stats')}>통계</TabButton>
              <TabButton active={tab==='settings'} onClick={()=>setTab('settings')}>설정</TabButton>
            </div>
          </nav>
          <main className="flex-1">
            <div className="max-w-3xl mx-auto p-6">
              {tab==='today' && (
                <section className="space-y-4">
                  {habits.map(h => {
                    const done = (h.completedDates||[]).includes(todayStr());
                    return (
                      <div key={h.id} className="bg-white rounded-xl border flex items-center justify-between p-4">
                        <div className="flex items-center gap-3">
                          <div className={\`w-10 h-10 grid place-items-center text-xl text-white rounded-lg \${h.color}\`}>{h.icon}</div>
                          <div>
                            <div className="font-semibold">{h.title}</div>
                            <div className="text-xs text-slate-500">{h.category}</div>
                          </div>
                        </div>
                        <button onClick={()=>toggleToday(h.id)} className={\`px-3 py-1.5 rounded-lg text-sm border \${done? 'bg-emerald-500 text-white border-emerald-500':'bg-white text-slate-700'}\`}>{done? '완료됨':'완료'}</button>
                      </div>
                    );
                  })}
                </section>
              )}
              {tab==='habits' && (
                <section className="space-y-3">
                  {habits.map(h => (
                    <div key={h.id} className="bg-white rounded-xl border p-4 flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <div className={\`w-9 h-9 grid place-items-center text-white rounded-md \${h.color}\`}>{h.icon}</div>
                        <div>
                          <div className="font-semibold">{h.title}</div>
                          <div className="text-xs text-slate-500">{h.category}</div>
                        </div>
                      </div>
                      <div className="flex gap-2">
                        <button onClick={()=>openEdit(h)} className="px-3 py-1.5 rounded-lg border">수정</button>
                        <button onClick={()=>removeHabit(h.id)} className="px-3 py-1.5 rounded-lg border text-rose-600">삭제</button>
                      </div>
                    </div>
                  ))}
                  <button onClick={()=>setShowAdd(true)} className="w-full py-3 rounded-xl bg-blue-600 text-white">새 습관 추가</button>
                </section>
              )}
              {tab==='stats' && (
                <section className="space-y-4">
                  <div className="bg-white rounded-xl border p-4">
                    <div className="font-semibold mb-2">오늘 진행률</div>
                    <div className="w-full h-3 bg-slate-200 rounded-full overflow-hidden">
                      <div className="h-full bg-emerald-500" style={{width: progress+"%"}} />
                    </div>
                    <div className="text-sm text-slate-600 mt-2">{completedTodayCount} / {totalCount} ({progress}%)</div>
                  </div>
                </section>
              )}
              {tab==='settings' && (
                <section className="space-y-4">
                  <div className="bg-white rounded-xl border p-4">
                    <div className="font-semibold mb-2">이름 변경</div>
                    <div className="flex gap-2">
                      <IMEInput value={userName} onChange={setUserName} placeholder="이름을 입력하세요" />
                      <button className="px-3 py-2 rounded-lg border">저장</button>
                    </div>
                  </div>
                </section>
              )}
            </div>
          </main>
          {showAdd && (
            <Modal title="새 습관 추가" onClose={()=>setShowAdd(false)}>
              <div className="space-y-4">
                <div>
                  <label className="text-sm text-slate-600">습관명</label>
                  <IMEInput autoFocus value={addForm.title} onChange={v=>setAddForm(s=>({...s, title:v}))} onSubmit={addHabit} placeholder="예: 매일 30분 운동하기" />
                </div>
                <div className="flex gap-2 pt-2">
                  <button onClick={()=>setShowAdd(false)} className="flex-1 px-4 py-3 rounded-xl border">취소</button>
                  <button onClick={addHabit} className="flex-1 px-4 py-3 rounded-xl bg-blue-600 text-white">추가</button>
                </div>
              </div>
            </Modal>
          )}
          {showEdit && editTarget && (
            <Modal title="습관 수정" onClose={()=>setShowEdit(false)}>
              <div className="space-y-4">
                <div>
                  <label className="text-sm text-slate-600">습관명</label>
                  <IMEInput autoFocus value={editTarget.title} onChange={v=>setEditTarget(s=>({...s, title:v}))} onSubmit={saveEdit} />
                </div>
                <div className="flex gap-2 pt-2">
                  <button onClick={()=>setShowEdit(false)} className="flex-1 px-4 py-3 rounded-xl border">취소</button>
                  <button onClick={saveEdit} className="flex-1 px-4 py-3 rounded-xl bg-blue-600 text-white">저장</button>
                </div>
              </div>
            </Modal>
          )}
          <footer className="text-center text-xs text-slate-500 py-6">© 2025 Habit Tracker</footer>
        </div>
      );
    }

    root.render(<App/>);
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>습관 트래커 - AI 기반 습관 관리</title>
    
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React, ReactDOM, and Babel (CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK v9 (CDN) -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .animate-slide-up {
            animation: slide-up 0.5s ease-out forwards;
        }
        @keyframes slide-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6 md:p-8">
    <div id="root" class="w-full max-w-4xl mx-auto rounded-3xl overflow-hidden shadow-2xl bg-white md:flex"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { getAuth, signInWithCustomToken, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } = firebase.auth;
        const { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, getDocFromCache } = firebase.firestore;

        // 환경에서 제공되는 Firebase 구성 전역 변수
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, auth, db;
        const initFirebase = async () => {
            try {
                if (!app) {
                    app = firebase.initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    db = getFirestore(app);
                    console.log('Firebase initialized successfully.');

                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log('Signed in with custom token.');
                    } else {
                        await auth.signInAnonymously();
                        console.log('Signed in anonymously.');
                    }
                }
            } catch (error) {
                console.error('Firebase initialization failed:', error);
            }
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [userId, setUserId] = useState(null);
            const [user, setUser] = useState(null);
            const [habits, setHabits] = useState([]);
            const [dailyRecords, setDailyRecords] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [modalType, setModalType] = useState('add');
            const [currentHabit, setCurrentHabit] = useState({ id: null, name: '', goal: '', unit: '', color: '#3B82F6' });
            const [isLoading, setIsLoading] = useState(true);
            const [showSnackbar, setShowSnackbar] = useState(false);
            const [snackbarMessage, setSnackbarMessage] = useState('');
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [showLoginModal, setShowLoginModal] = useState(false);
            const [isLoginMode, setIsLoginMode] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [authError, setAuthError] = useState('');
            const [showPromptModal, setShowPromptModal] = useState(false);
            const [promptMessage, setPromptMessage] = useState('');
            const [onPromptConfirm, setOnPromptConfirm] = useState(() => () => {});

            useEffect(() => {
                initFirebase();
                const unsubscribe = onAuthStateChanged(auth, (authUser) => {
                    setUser(authUser);
                    if (authUser) {
                        setUserId(authUser.uid);
                    }
                    setIsAuthReady(true);
                    console.log('Auth state changed. User:', authUser);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!isAuthReady || !userId) return;
                setIsLoading(true);
                console.log('Fetching data for user:', userId);

                const publicHabitsCollectionRef = collection(db, `artifacts/${appId}/public/data/habits`);
                const userHabitsCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/habits`);
                const userRecordsCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/dailyRecords`);

                const unsubscribeHabits = onSnapshot(userHabitsCollectionRef, (snapshot) => {
                    const habitData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setHabits(habitData);
                    console.log('Habits updated:', habitData);
                    setIsLoading(false);
                }, (error) => {
                    console.error('Error fetching habits:', error);
                    setIsLoading(false);
                });

                const unsubscribeRecords = onSnapshot(userRecordsCollectionRef, (snapshot) => {
                    const recordData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setDailyRecords(recordData);
                    console.log('Daily records updated:', recordData);
                    setIsLoading(false);
                }, (error) => {
                    console.error('Error fetching records:', error);
                    setIsLoading(false);
                });

                return () => {
                    unsubscribeHabits();
                    unsubscribeRecords();
                };
            }, [isAuthReady, userId]);

            const showSnackbarMessage = (message) => {
                setSnackbarMessage(message);
                setShowSnackbar(true);
                setTimeout(() => setShowSnackbar(false), 3000);
            };

            const showPrompt = (message, onConfirm) => {
                setPromptMessage(message);
                setOnPromptConfirm(() => onConfirm);
                setShowPromptModal(true);
            };

            const handlePromptConfirm = () => {
                onPromptConfirm();
                setShowPromptModal(false);
            };

            const handleAddHabit = async () => {
                if (!currentHabit.name || !currentHabit.goal || !currentHabit.unit) {
                    showSnackbarMessage('모든 필드를 입력해 주세요.');
                    return;
                }
                setIsLoading(true);
                try {
                    await addDoc(collection(db, `artifacts/${appId}/users/${userId}/habits`), {
                        ...currentHabit,
                        goal: Number(currentHabit.goal),
                        createdAt: new Date()
                    });
                    showSnackbarMessage('습관이 성공적으로 추가되었습니다.');
                    setShowModal(false);
                } catch (e) {
                    console.error('Error adding habit:', e);
                    showSnackbarMessage('습관 추가에 실패했습니다.');
                }
                setIsLoading(false);
            };

            const handleUpdateHabit = async () => {
                if (!currentHabit.name || !currentHabit.goal || !currentHabit.unit) {
                    showSnackbarMessage('모든 필드를 입력해 주세요.');
                    return;
                }
                setIsLoading(true);
                try {
                    const habitRef = doc(db, `artifacts/${appId}/users/${userId}/habits`, currentHabit.id);
                    await updateDoc(habitRef, {
                        name: currentHabit.name,
                        goal: Number(currentHabit.goal),
                        unit: currentHabit.unit,
                        color: currentHabit.color
                    });
                    showSnackbarMessage('습관이 성공적으로 수정되었습니다.');
                    setShowModal(false);
                } catch (e) {
                    console.error('Error updating habit:', e);
                    showSnackbarMessage('습관 수정에 실패했습니다.');
                }
                setIsLoading(false);
            };

            const handleDeleteHabit = async (habitId) => {
                showPrompt('이 습관을 정말로 삭제하시겠습니까? 모든 관련 기록도 함께 삭제됩니다.', async () => {
                    setIsLoading(true);
                    try {
                        const q = query(collection(db, `artifacts/${appId}/users/${userId}/dailyRecords`), where("habitId", "==", habitId));
                        const querySnapshot = await getDocs(q);
                        const batch = firebase.firestore().batch();
                        querySnapshot.forEach((doc) => {
                            batch.delete(doc.ref);
                        });
                        await batch.commit();

                        const habitRef = doc(db, `artifacts/${appId}/users/${userId}/habits`, habitId);
                        await deleteDoc(habitRef);
                        showSnackbarMessage('습관이 성공적으로 삭제되었습니다.');
                    } catch (e) {
                        console.error('Error deleting habit:', e);
                        showSnackbarMessage('습관 삭제에 실패했습니다.');
                    }
                    setIsLoading(false);
                });
            };

            const handleRecordChange = async (habitId, date, value) => {
                const dateStr = date.toISOString().split('T')[0];
                const recordRef = doc(db, `artifacts/${appId}/users/${userId}/dailyRecords`, `${dateStr}-${habitId}`);
                
                setIsLoading(true);
                try {
                    if (value === '') {
                         await deleteDoc(recordRef);
                    } else {
                        await setDoc(recordRef, {
                            habitId,
                            date: dateStr,
                            value: Number(value),
                            timestamp: new Date()
                        }, { merge: true });
                    }
                } catch (e) {
                    console.error('Error updating record:', e);
                    showSnackbarMessage('기록 업데이트에 실패했습니다.');
                }
                setIsLoading(false);
            };
            
            const handleAuth = async () => {
                if (!email || !password) {
                    setAuthError('이메일과 비밀번호를 입력해 주세요.');
                    return;
                }
                setAuthError('');
                try {
                    if (isLoginMode) {
                        await signInWithEmailAndPassword(auth, email, password);
                        showSnackbarMessage('로그인 성공!');
                    } else {
                        await createUserWithEmailAndPassword(auth, email, password);
                        showSnackbarMessage('회원가입 성공!');
                    }
                    setShowLoginModal(false);
                } catch (error) {
                    setAuthError(error.message);
                }
            };
            
            const handleLogout = async () => {
                await signOut(auth);
                setUserId(null);
                showSnackbarMessage('로그아웃되었습니다.');
            };

            // 모달 컴포넌트
            const Modal = ({ children, onClose }) => (
                <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50 transition-opacity duration-300">
                    <div className="bg-white rounded-3xl p-6 w-full max-w-md shadow-2xl relative animate-slide-up">
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                        {children}
                    </div>
                </div>
            );
            
            const PromptModal = ({ children, onConfirm, onClose }) => (
                <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50 transition-opacity duration-300">
                    <div className="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl relative animate-slide-up">
                        <p className="text-lg font-medium text-gray-800 mb-6">{children}</p>
                        <div className="flex justify-end space-x-4">
                            <button onClick={onClose} className="px-4 py-2 text-gray-600 rounded-xl hover:bg-gray-100 transition-colors">취소</button>
                            <button onClick={onConfirm} className="px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors">확인</button>
                        </div>
                    </div>
                </div>
            );

            // 대시보드 탭
            const renderDashboardTab = () => {
                const today = new Date().toISOString().split('T')[0];
                
                const habitsWithRecords = habits.map(habit => {
                    const record = dailyRecords.find(r => r.habitId === habit.id && r.date === today);
                    return { ...habit, recordValue: record ? record.value : '' };
                });

                const totalRecords = dailyRecords.filter(r => r.date === today).length;
                const totalHabits = habits.length;
                const completionPercentage = totalHabits > 0 ? Math.round((totalRecords / totalHabits) * 100) : 0;
                
                return (
                    <div className="space-y-6 pb-20">
                        <div className="bg-white rounded-xl p-4 shadow-sm">
                            <h2 className="text-xl font-bold text-gray-900 mb-2">오늘의 성과</h2>
                            <div className="flex items-center space-x-2">
                                <div className="w-16 h-16 rounded-full flex items-center justify-center font-bold text-xl text-white bg-gradient-to-br from-blue-400 to-purple-400">
                                    {completionPercentage}%
                                </div>
                                <span className="text-gray-600">{totalRecords} / {totalHabits}</span>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl p-4 shadow-sm">
                            <h3 className="text-lg font-bold text-gray-900 mb-4">오늘의 습관들</h3>
                            {isLoading ? (
                                <div className="flex justify-center items-center h-48">
                                    <div className="loading-spinner"></div>
                                </div>
                            ) : habitsWithRecords.length === 0 ? (
                                <p className="text-gray-500">아직 등록된 습관이 없습니다. 새 습관을 추가해 보세요!</p>
                            ) : (
                                habitsWithRecords.map(habit => (
                                    <div key={habit.id} className="flex items-center justify-between p-3 border-b last:border-0 border-gray-100">
                                        <div className="flex items-center space-x-3">
                                            <div className="w-4 h-4 rounded-full" style={{ backgroundColor: habit.color }}></div>
                                            <span className="text-gray-800 font-medium">{habit.name}</span>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <input
                                                type="number"
                                                value={habit.recordValue}
                                                onChange={(e) => handleRecordChange(habit.id, new Date(), e.target.value)}
                                                placeholder="0"
                                                className="w-20 text-center border border-gray-300 rounded-lg p-2 text-sm focus:border-blue-500 focus:ring-blue-500 transition-colors"
                                            />
                                            <span className="text-sm text-gray-500">/ {habit.goal} {habit.unit}</span>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                );
            };

            // 습관 목록 탭
            const renderHabitListTab = () => (
                <div className="space-y-6 pb-20">
                    <button
                        onClick={() => {
                            setModalType('add');
                            setCurrentHabit({ id: null, name: '', goal: '', unit: '', color: '#3B82F6' });
                            setShowModal(true);
                        }}
                        className="w-full flex items-center justify-center p-4 bg-blue-500 text-white rounded-xl shadow-md hover:bg-blue-600 transition-colors font-bold"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fillRule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clipRule="evenodd" />
                        </svg>
                        새 습관 추가
                    </button>
                    {habits.length === 0 ? (
                        <div className="bg-white rounded-xl p-4 text-center text-gray-500">
                            <p>아직 등록된 습관이 없습니다.</p>
                        </div>
                    ) : (
                        habits.map(habit => (
                            <div key={habit.id} className="bg-white rounded-xl p-4 shadow-sm flex items-center justify-between transition-transform duration-200 hover:scale-[1.01]">
                                <div className="flex items-center space-x-4">
                                    <div className="w-5 h-5 rounded-full" style={{ backgroundColor: habit.color }}></div>
                                    <div>
                                        <h3 className="font-bold text-gray-900">{habit.name}</h3>
                                        <p className="text-sm text-gray-600">{habit.goal} {habit.unit} 목표</p>
                                    </div>
                                </div>
                                <div className="flex space-x-2">
                                    <button
                                        onClick={() => {
                                            setModalType('edit');
                                            setCurrentHabit(habit);
                                            setShowModal(true);
                                        }}
                                        className="p-2 rounded-full text-gray-500 hover:bg-gray-100 transition-colors"
                                        aria-label="Edit Habit"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                                            <path fillRule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clipRule="evenodd" />
                                        </svg>
                                    </button>
                                    <button
                                        onClick={() => handleDeleteHabit(habit.id)}
                                        className="p-2 rounded-full text-gray-500 hover:bg-red-100 hover:text-red-500 transition-colors"
                                        aria-label="Delete Habit"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clipRule="evenodd" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        ))
                    )}
                </div>
            );

            // 캘린더 탭
            const renderCalendarTab = () => {
                const startDay = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1);
                const endDay = new Date(selectedDate.getFullYear(), selectedDate.getMonth() + 1, 0);
                const numDays = endDay.getDate();
                
                const calendarDays = [];
                for (let i = 1; i <= numDays; i++) {
                    const date = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), i);
                    const dateStr = date.toISOString().split('T')[0];
                    const dailyCompletion = habits.length > 0 ? (dailyRecords.filter(r => r.date === dateStr).length / habits.length) : 0;
                    const completionPercentage = Math.round(dailyCompletion * 100);

                    const getColorClass = (percent) => {
                        if (percent === 0) return 'bg-gray-50';
                        if (percent > 0 && percent <= 25) return 'bg-blue-50';
                        if (percent > 25 && percent <= 50) return 'bg-blue-100';
                        if (percent > 50 && percent <= 75) return 'bg-blue-200';
                        return 'bg-gradient-to-br from-blue-400 to-purple-400';
                    };
                    
                    calendarDays.push(
                        <div key={i} onClick={() => setSelectedDate(date)} className={`flex flex-col items-center justify-center p-2 rounded-lg cursor-pointer transition-colors ${getColorClass(completionPercentage)} hover:scale-105 transform ${dateStr === new Date().toISOString().split('T')[0] ? 'border-2 border-blue-500' : ''}`}>
                            <span className="text-sm font-bold text-gray-800">{i}</span>
                            <span className="text-xs text-gray-600 mt-1">{completionPercentage}%</span>
                        </div>
                    );
                }

                const dailyDetail = dailyRecords.filter(r => r.date === selectedDate.toISOString().split('T')[0]);

                return (
                    <div className="space-y-6 pb-20">
                        <div className="bg-white rounded-xl p-4 shadow-sm">
                            <h2 className="text-xl font-bold text-gray-900 mb-4">월간 달력</h2>
                            <div className="flex items-center justify-between mb-4">
                                <button onClick={() => setSelectedDate(new Date(selectedDate.getFullYear(), selectedDate.getMonth() - 1, 1))} className="p-2 rounded-full hover:bg-gray-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" /></svg>
                                </button>
                                <span className="font-bold text-lg text-gray-800">
                                    {selectedDate.getFullYear()}년 {selectedDate.getMonth() + 1}월
                                </span>
                                <button onClick={() => setSelectedDate(new Date(selectedDate.getFullYear(), selectedDate.getMonth() + 1, 1))} className="p-2 rounded-full hover:bg-gray-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clipRule="evenodd" /></svg>
                                </button>
                            </div>
                            <div className="grid grid-cols-7 gap-1 text-center font-medium text-sm text-gray-500">
                                <span>일</span><span>월</span><span>화</span><span>수</span><span>목</span><span>금</span><span>토</span>
                            </div>
                            <div className="grid grid-cols-7 gap-2 mt-2">
                                {calendarDays}
                            </div>
                        </div>

                        <div className="bg-white rounded-xl p-4 shadow-sm">
                            <h3 className="font-bold text-gray-900 mb-3">{selectedDate.getFullYear()}년 {selectedDate.getMonth() + 1}월 {selectedDate.getDate()}일 기록</h3>
                            {dailyDetail.length > 0 ? (
                                dailyDetail.map(record => {
                                    const habit = habits.find(h => h.id === record.habitId);
                                    if (!habit) return null;
                                    return (
                                        <div key={record.id} className="flex items-center justify-between p-3 border-b last:border-0 border-gray-100">
                                            <div className="flex items-center space-x-3">
                                                <div className="w-4 h-4 rounded-full" style={{ backgroundColor: habit.color }}></div>
                                                <span className="text-gray-800 font-medium">{habit.name}</span>
                                            </div>
                                            <span className="text-gray-600">{record.value} {habit.unit}</span>
                                        </div>
                                    );
                                })
                            ) : (
                                <p className="text-sm text-gray-500">이날 기록된 습관이 없습니다.</p>
                            )}
                        </div>
                    </div>
                );
            };

            // 설정 탭
            const renderSettingsTab = () => (
                <div className="pb-20">
                    <h2 className="text-xl font-bold text-gray-900 mb-6">설정</h2>
                    
                    <div className="space-y-4">
                        <div className="bg-white rounded-xl p-4 shadow-sm flex justify-between items-center">
                            <div className="flex flex-col">
                                <span className="font-medium text-gray-900">사용자 ID</span>
                                <span className="text-sm text-gray-500 break-all">{userId || '로그인되지 않음'}</span>
                            </div>
                        </div>
                        {user && user.isAnonymous ? (
                             <button
                                 onClick={() => {
                                     setShowLoginModal(true);
                                     setIsLoginMode(false);
                                 }}
                                 className="w-full bg-blue-500 text-white p-4 rounded-xl shadow-md hover:bg-blue-600 transition-colors"
                             >
                                 로그인 또는 회원가입
                             </button>
                         ) : (
                             <button
                                 onClick={handleLogout}
                                 className="w-full bg-red-500 text-white p-4 rounded-xl shadow-md hover:bg-red-600 transition-colors"
                             >
                                 로그아웃
                             </button>
                         )}
                    </div>
                </div>
            );

            // 전체 UI
            return (
                <div className="flex flex-col md:flex-row w-full max-w-4xl min-h-[80vh] rounded-3xl overflow-hidden shadow-2xl bg-white">
                    {/* Sidebar */}
                    <div className="bg-white md:bg-gray-50 border-r border-gray-200 md:w-64 p-4 flex flex-row md:flex-col justify-around md:justify-start space-x-2 md:space-x-0 md:space-y-4 fixed bottom-0 left-0 right-0 md:static z-40 shadow-lg md:shadow-none">
                        <button
                            onClick={() => setActiveTab('dashboard')}
                            className={`flex flex-col items-center p-2 rounded-xl text-sm font-medium ${activeTab === 'dashboard' ? 'bg-blue-500 text-white' : 'text-gray-500 hover:bg-gray-200 hover:text-gray-800'} transition-colors w-1/3 md:w-auto`}
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <path d="M12 8v8M8 12h8"></path>
                            </svg>
                            <span className="hidden md:block mt-1">대시보드</span>
                        </button>
                        <button
                            onClick={() => setActiveTab('habits')}
                            className={`flex flex-col items-center p-2 rounded-xl text-sm font-medium ${activeTab === 'habits' ? 'bg-blue-500 text-white' : 'text-gray-500 hover:bg-gray-200 hover:text-gray-800'} transition-colors w-1/3 md:w-auto`}
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <line x1="10" y1="9" x2="8" y2="9"></line>
                            </svg>
                            <span className="hidden md:block mt-1">습관 관리</span>
                        </button>
                        <button
                            onClick={() => setActiveTab('calendar')}
                            className={`flex flex-col items-center p-2 rounded-xl text-sm font-medium ${activeTab === 'calendar' ? 'bg-blue-500 text-white' : 'text-gray-500 hover:bg-gray-200 hover:text-gray-800'} transition-colors w-1/3 md:w-auto`}
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <span className="hidden md:block mt-1">캘린더</span>
                        </button>
                        <button
                            onClick={() => setActiveTab('settings')}
                            className={`flex flex-col items-center p-2 rounded-xl text-sm font-medium ${activeTab === 'settings' ? 'bg-blue-500 text-white' : 'text-gray-500 hover:bg-gray-200 hover:text-gray-800'} transition-colors w-1/3 md:w-auto`}
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M19.4 15a1.65 1.65 0 0 0 .33-.61A1.65 1.65 0 0 0 20 13.91l-1.92-1.82a1.65 1.65 0 0 0-.1-1.4l.74-2.82A1.65 1.65 0 0 0 16.5 4l-2.82.74a1.65 1.65 0 0 0-1.4-.1L9.09 3c-.22-.04-.45-.04-.68 0L6.23 4.74a1.65 1.65 0 0 0-1.4.1L3 6.23c-.04.23-.04.46 0 .68l.74 2.82a1.65 1.65 0 0 0-.1 1.4l-1.92 1.82A1.65 1.65 0 0 0 4 13.91l2.82-.74a1.65 1.65 0 0 0 1.4.1l2.82.74a1.65 1.65 0 0 0 1.4-.1l1.92-1.82z"></path>
                            </svg>
                            <span className="hidden md:block mt-1">설정</span>
                        </button>
                    </div>

                    {/* Main Content */}
                    <main className="flex-1 p-4 md:p-8 bg-gray-100 min-h-screen">
                        {activeTab === 'dashboard' && renderDashboardTab()}
                        {activeTab === 'habits' && renderHabitListTab()}
                        {activeTab === 'calendar' && renderCalendarTab()}
                        {activeTab === 'settings' && renderSettingsTab()}
                    </main>

                    {/* Add/Edit Modal */}
                    {showModal && (
                        <Modal onClose={() => setShowModal(false)}>
                            <h2 className="text-2xl font-bold text-gray-900 mb-4">{modalType === 'add' ? '새 습관 추가' : '습관 수정'}</h2>
                            <div className="space-y-4">
                                <div>
                                    <label htmlFor="habitName" className="block text-sm font-medium text-gray-700">습관 이름</label>
                                    <input type="text" id="habitName" value={currentHabit.name} onChange={(e) => setCurrentHabit({ ...currentHabit, name: e.target.value })} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors" placeholder="예: 물 마시기" />
                                </div>
                                <div className="flex space-x-4">
                                    <div className="flex-1">
                                        <label htmlFor="habitGoal" className="block text-sm font-medium text-gray-700">목표 수치</label>
                                        <input type="number" id="habitGoal" value={currentHabit.goal} onChange={(e) => setCurrentHabit({ ...currentHabit, goal: e.target.value })} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors" placeholder="예: 2000" />
                                    </div>
                                    <div className="flex-1">
                                        <label htmlFor="habitUnit" className="block text-sm font-medium text-gray-700">단위</label>
                                        <input type="text" id="habitUnit" value={currentHabit.unit} onChange={(e) => setCurrentHabit({ ...currentHabit, unit: e.target.value })} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors" placeholder="예: ml" />
                                    </div>
                                </div>
                                <div>
                                    <label htmlFor="habitColor" className="block text-sm font-medium text-gray-700">색상</label>
                                    <div className="flex items-center space-x-2 mt-2">
                                        {['#3B82F6', '#8B5CF6', '#F43F5E', '#EC4899', '#22C55E', '#14B8A6', '#F59E0B'].map(color => (
                                            <div key={color} onClick={() => setCurrentHabit({ ...currentHabit, color: color })} className={`w-8 h-8 rounded-full cursor-pointer border-2 ${currentHabit.color === color ? 'border-blue-500 scale-110' : 'border-transparent'}`} style={{ backgroundColor: color }}></div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            <div className="mt-6">
                                <button
                                    onClick={modalType === 'add' ? handleAddHabit : handleUpdateHabit}
                                    className="w-full bg-blue-500 text-white p-3 rounded-xl shadow-md hover:bg-blue-600 transition-colors font-bold"
                                >
                                    {modalType === 'add' ? '저장' : '수정'}
                                </button>
                            </div>
                        </Modal>
                    )}
                    
                    {/* Login/Signup Modal */}
                    {showLoginModal && (
                        <Modal onClose={() => setShowLoginModal(false)}>
                            <h2 className="text-2xl font-bold text-gray-900 mb-4">{isLoginMode ? '로그인' : '회원가입'}</h2>
                            <div className="space-y-4">
                                <div>
                                    <label htmlFor="authEmail" className="block text-sm font-medium text-gray-700">이메일</label>
                                    <input type="email" id="authEmail" value={email} onChange={(e) => setEmail(e.target.value)} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors" placeholder="name@example.com" />
                                </div>
                                <div>
                                    <label htmlFor="authPassword" className="block text-sm font-medium text-gray-700">비밀번호</label>
                                    <input type="password" id="authPassword" value={password} onChange={(e) => setPassword(e.target.value)} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors" />
                                </div>
                                {authError && (
                                    <p className="text-sm text-red-500 mt-2">{authError}</p>
                                )}
                            </div>
                            <div className="mt-6">
                                <button
                                    onClick={handleAuth}
                                    className="w-full bg-blue-500 text-white p-3 rounded-xl shadow-md hover:bg-blue-600 transition-colors font-bold"
                                >
                                    {isLoginMode ? '로그인' : '회원가입'}
                                </button>
                            </div>
                            <div className="text-center mt-4">
                                <button onClick={() => setIsLoginMode(!isLoginMode)} className="text-sm text-blue-500 hover:underline">
                                    {isLoginMode ? '계정이 없으신가요? 회원가입' : '이미 계정이 있으신가요? 로그인'}
                                </button>
                            </div>
                        </Modal>
                    )}

                    {/* Prompt Modal */}
                    {showPromptModal && (
                        <PromptModal onConfirm={handlePromptConfirm} onClose={() => setShowPromptModal(false)}>
                            {promptMessage}
                        </PromptModal>
                    )}
                    
                    {/* Snackbar */}
                    {showSnackbar && (
                        <div className="fixed bottom-24 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-xl shadow-lg transition-all duration-300 animate-slide-up z-50">
                            {snackbarMessage}
                        </div>
                    )}
                </div>
            );
        };

        // Render the app
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('root');
            if (container) {
                ReactDOM.createRoot(container).render(<App />);
            } else {
                console.error("Root element with id 'root' not found.");
            }
        });
    </script>
</body>
</html>
